<!doctype html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<body>
<div th:replace="admin/layout :: layout(~{::content})">
  <div th:fragment="content">
    <!-- Kubernetes Resources Management Page -->
    <div class="page-title-row">
      <div>
        <div class="page-title">‚ò∏Ô∏è Kubernetes Resources</div>
        <div class="page-subtitle">Qu·∫£n l√Ω t√†i nguy√™n Kubernetes (Pods, Namespaces, Workloads, Services, Ingress).</div>
      </div>
      <div style="display: flex; gap: 8px; align-items: center;">
        <button class="btn" id="refresh-k8s-resources">üîÑ L√†m m·ªõi</button>
        <button class="btn" id="cd-back" onclick="window.location.href='/admin/cluster'">‚Üê Quay l·∫°i danh s√°ch</button>
      </div>
    </div>

    <!-- Kubernetes Resources Management Section -->
    <div class="table-card" id="k8s-resources-detail" style="margin-top: 20px;">
      <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
        <div class="page-title" style="font-size: 16px; margin-bottom: 0;">üì¶ Qu·∫£n l√Ω t√†i nguy√™n Kubernetes</div>
        <button class="btn" id="refresh-k8s-resources">üîÑ L√†m m·ªõi</button>
      </div>

      <!-- Resource Tabs -->
      <ul class="nav-tabs" id="k8s-resource-tabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="pods-tab" data-bs-toggle="tab" data-bs-target="#pods-content"
            type="button" role="tab" aria-controls="pods-content" aria-selected="true">
            üì¶ Pods
            <span class="chip" style="background: #E0E0E0; color: #666666; margin-left: 6px; font-size: 11px;" id="pods-count">0</span>
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="namespaces-tab" data-bs-toggle="tab" data-bs-target="#namespaces-content"
            type="button" role="tab" aria-controls="namespaces-content" aria-selected="false">
            üìÇ Namespaces
            <span class="chip" style="background: #E0E0E0; color: #666666; margin-left: 6px; font-size: 11px;" id="namespaces-count">0</span>
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="workloads-tab" data-bs-toggle="tab" data-bs-target="#workloads-content"
            type="button" role="tab" aria-controls="workloads-content" aria-selected="false">
            ‚öôÔ∏è Workloads
            <span class="chip" style="background: #E0E0E0; color: #666666; margin-left: 6px; font-size: 11px;" id="workloads-count">0</span>
          </button>
        </li>
      </ul>

      <!-- Tab Content -->
      <div class="tab-content" id="k8s-resource-tab-content">
        <!-- Pods Tab -->
        <div class="tab-pane fade show active" id="pods-content" role="tabpanel" aria-labelledby="pods-tab">
          <div style="margin-top: 16px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; flex-wrap: wrap; gap: 12px;">
              <div class="page-title" style="font-size: 14px; margin-bottom: 0;">Danh s√°ch Pods</div>
              <div style="display: flex; gap: 8px;">
                <input type="text" class="form-control" style="width: 200px; font-size: 13px;" id="pods-search"
                  placeholder="üîç T√¨m ki·∫øm pod...">
                <select class="form-control" style="width: 150px; font-size: 13px;" id="pods-namespace-filter">
                  <option value="">T·∫•t c·∫£ namespace</option>
                </select>
              </div>
            </div>
            <div class="table-card">
              <table class="table">
                <thead>
                  <tr>
                    <th>Namespace</th>
                    <th>Name</th>
                    <th>Node</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="pods-tbody">
                  <tr>
                    <td colspan="5" class="text-center" style="color: #666666; padding: 20px;">ƒêang t·∫£i d·ªØ li·ªáu...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Namespaces Tab -->
        <div class="tab-pane fade" id="namespaces-content" role="tabpanel" aria-labelledby="namespaces-tab">
          <div style="margin-top: 16px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
              <div class="page-title" style="font-size: 14px; margin-bottom: 0;">Danh s√°ch Namespaces</div>
              <input type="text" class="form-control" style="width: 200px; font-size: 13px;" id="namespaces-search"
                placeholder="üîç T√¨m ki·∫øm namespace...">
            </div>
            <div class="table-card">
              <table class="table">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="namespaces-tbody">
                  <tr>
                    <td colspan="3" class="text-center" style="color: #666666; padding: 20px;">ƒêang t·∫£i d·ªØ li·ªáu...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Workloads Tab -->
        <div class="tab-pane fade" id="workloads-content" role="tabpanel" aria-labelledby="workloads-tab">
          <div style="margin-top: 16px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; flex-wrap: wrap; gap: 12px;">
              <div class="page-title" style="font-size: 14px; margin-bottom: 0;">Danh s√°ch Workloads</div>
              <div style="display: flex; gap: 8px;">
                <input type="text" class="form-control" style="width: 200px; font-size: 13px;" id="workloads-search"
                  placeholder="üîç T√¨m ki·∫øm workload...">
                <select class="form-control" style="width: 150px; font-size: 13px;" id="workloads-type-filter">
                  <option value="">T·∫•t c·∫£ lo·∫°i</option>
                  <option value="deployment">Deployments</option>
                  <option value="statefulset">StatefulSets</option>
                  <option value="daemonset">DaemonSets</option>
                </select>
              </div>
            </div>
            <div class="table-card">
              <table class="table">
                <thead>
                  <tr>
                    <th>Type</th>
                    <th>Namespace</th>
                    <th>Name</th>
                    <th>Ready/Total</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="workloads-tbody">
                  <tr>
                    <td colspan="5" class="text-center" style="color: #666666; padding: 20px;">ƒêang t·∫£i d·ªØ li·ªáu...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Networking Section -->
    <div class="table-card" id="networking-resources-detail" style="margin-top: 20px;">
      <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
        <div class="page-title" style="font-size: 16px; margin-bottom: 0;">üåê Networking</div>
        <button class="btn" id="refresh-networking-resources">üîÑ L√†m m·ªõi</button>
      </div>

      <!-- Networking Tabs -->
      <ul class="nav-tabs" id="networking-tabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="services-tab" data-bs-toggle="tab" data-bs-target="#services-content"
            type="button" role="tab" aria-controls="services-content" aria-selected="true">
            üîå Services
            <span class="chip" style="background: #E0E0E0; color: #666666; margin-left: 6px; font-size: 11px;" id="services-count">0</span>
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="ingress-tab" data-bs-toggle="tab" data-bs-target="#ingress-content"
            type="button" role="tab" aria-controls="ingress-content" aria-selected="false">
            üö™ Ingress
            <span class="chip" style="background: #E0E0E0; color: #666666; margin-left: 6px; font-size: 11px;" id="ingress-count">0</span>
          </button>
        </li>
      </ul>

      <!-- Tab Content -->
      <div class="tab-content" id="networking-tab-content">
        <!-- Services Tab -->
        <div class="tab-pane fade show active" id="services-content" role="tabpanel" aria-labelledby="services-tab">
          <div style="margin-top: 16px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; flex-wrap: wrap; gap: 12px;">
              <div class="page-title" style="font-size: 14px; margin-bottom: 0;">Danh s√°ch Services</div>
              <div style="display: flex; gap: 8px;">
                <input type="text" class="form-control" style="width: 200px; font-size: 13px;" id="services-search"
                  placeholder="üîç T√¨m ki·∫øm service...">
                <select class="form-control" style="width: 150px; font-size: 13px;" id="services-namespace-filter">
                  <option value="">T·∫•t c·∫£ namespace</option>
                </select>
                <select class="form-control" style="width: 150px; font-size: 13px;" id="services-type-filter">
                  <option value="">T·∫•t c·∫£ lo·∫°i</option>
                  <option value="ClusterIP">ClusterIP</option>
                  <option value="NodePort">NodePort</option>
                  <option value="LoadBalancer">LoadBalancer</option>
                  <option value="ExternalName">ExternalName</option>
                </select>
              </div>
            </div>
            <div class="table-card">
              <table class="table">
                <thead>
                  <tr>
                    <th>Namespace</th>
                    <th>Name</th>
                    <th>Type</th>
                    <th>Cluster-IP</th>
                    <th>External-IP</th>
                    <th>Port(s)</th>
                    <th>Age</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="services-tbody">
                  <tr>
                    <td colspan="8" class="text-center" style="color: #666666; padding: 20px;">ƒêang t·∫£i d·ªØ li·ªáu...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Ingress Tab -->
        <div class="tab-pane fade" id="ingress-content" role="tabpanel" aria-labelledby="ingress-tab">
          <div style="margin-top: 16px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; flex-wrap: wrap; gap: 12px;">
              <div class="page-title" style="font-size: 14px; margin-bottom: 0;">Danh s√°ch Ingress</div>
              <div style="display: flex; gap: 8px;">
                <input type="text" class="form-control" style="width: 200px; font-size: 13px;" id="ingress-search"
                  placeholder="üîç T√¨m ki·∫øm ingress...">
                <select class="form-control" style="width: 150px; font-size: 13px;" id="ingress-namespace-filter">
                  <option value="">T·∫•t c·∫£ namespace</option>
                </select>
              </div>
            </div>
            <div class="table-card">
              <table class="table">
                <thead>
                  <tr>
                    <th>Namespace</th>
                    <th>Name</th>
                    <th>Class</th>
                    <th>Host</th>
                    <th>Address</th>
                    <th>Ports</th>
                    <th>Age</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="ingress-tbody">
                  <tr>
                    <td colspan="8" class="text-center" style="color: #666666; padding: 20px;">ƒêang t·∫£i d·ªØ li·ªáu...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modals -->
    <!-- Add Node Modal -->
    <div class="modal fade" id="addNodeModal" tabindex="-1" aria-labelledby="addNodeModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-scrollable modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="addNodeModalLabel">Th√™m Node v√†o Cluster: <span id="add-node-cluster-name"></span></h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <!-- Tabs Navigation -->
            <ul class="nav nav-tabs" id="addNodeTabs" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" id="select-existing-tab" data-bs-toggle="tab" data-bs-target="#select-existing" type="button" role="tab" aria-controls="select-existing" aria-selected="true">
                  üìã Ch·ªçn Node c√≥ s·∫µn
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="add-new-tab" data-bs-toggle="tab" data-bs-target="#add-new" type="button" role="tab" aria-controls="add-new" aria-selected="false">
                  ‚ûï Th√™m Node m·ªõi
                </button>
              </li>
            </ul>

            <!-- Tab Content -->
            <div class="tab-content" id="addNodeTabContent">
              <!-- Select Existing Nodes Tab -->
              <div class="tab-pane fade show active" id="select-existing" role="tabpanel" aria-labelledby="select-existing-tab">
                <div class="mt-3">
                  <p class="text-muted small">Ch·ªçn c√°c server c√≥ s·∫µn ƒë·ªÉ th√™m v√†o cluster:</p>
                  <div class="table-responsive max-h-40vh">
                    <table class="table table-sm">
                      <thead>
                        <tr>
                          <th style="width:36px;"><input type="checkbox" id="existing-nodes-check-all"></th>
                          <th>ID</th>
                          <th>Host</th>
                          <th>Port</th>
                          <th>Username</th>
                          <th>Status</th>
                        </tr>
                      </thead>
                      <tbody id="existing-nodes-tbody">
                        <tr><td colspan="6" class="text-center text-muted">ƒêang t·∫£i...</td></tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>

              <!-- Add New Node Tab -->
              <div class="tab-pane fade" id="add-new" role="tabpanel" aria-labelledby="add-new-tab">
                <form id="add-node-form" class="mt-3">
                  <input type="hidden" id="add-node-cluster-id" name="clusterId">
                  <div class="mb-3">
                    <label for="add-node-host" class="form-label">Host/IP <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="add-node-host" name="host" placeholder="192.168.1.100" required>
                  </div>
                  <div class="mb-3">
                    <label for="add-node-port" class="form-label">Port <span class="text-danger">*</span></label>
                    <input type="number" class="form-control" id="add-node-port" name="port" value="22" min="1" max="65535" required>
                  </div>
                  <div class="mb-3">
                    <label for="add-node-username" class="form-label">Username <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="add-node-username" name="username" placeholder="root" required autocomplete="username">
                  </div>
                  <div class="mb-3">
                    <label for="add-node-password" class="form-label">Password <span class="text-danger">*</span></label>
                    <input type="password" class="form-control" id="add-node-password" name="password" placeholder="Password" required>
                  </div>
                  <div class="mb-3">
                    <label for="add-node-role" class="form-label">Role <span class="text-danger">*</span></label>
                    <select class="form-select" id="add-node-role" name="role" required>
                      <option value="WORKER" selected>WORKER</option>
                      <option value="MASTER">MASTER</option>
                    </select>
                    <div class="form-text">Ch·ªçn MASTER n·∫øu l√† master node, WORKER cho worker nodes</div>
                  </div>
                </form>
              </div>
            </div>

            <!-- Messages -->
            <div id="add-node-msg" class="small mt-3"></div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
            <button type="button" class="btn btn-success d-none" id="add-existing-nodes-btn">
              üìã Th√™m Node ƒë√£ ch·ªçn
            </button>
            <button type="submit" form="add-node-form" class="btn btn-success" id="add-node-submit-btn">
              ‚ûï Th√™m Node m·ªõi
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- End Add Node Modal -->

    <!-- K8s Output Modal (for describe operations) -->
    <div class="modal fade" id="k8s-output-modal" tabindex="-1" aria-labelledby="k8s-output-modalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-scrollable modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="k8s-output-modalLabel">
              ‚ÑπÔ∏è <span id="k8s-output-title">Chi ti·∫øt Kubernetes Resource</span>
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body p-0">
            <pre class="bg-dark text-light p-3 mb-0" style="max-height: 70vh; overflow: auto; font-family: monospace; font-size: 13px; white-space: pre-wrap; word-wrap: break-word;"><code id="k8s-output-content"></code></pre>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
              ‚úñÔ∏è ƒê√≥ng
            </button>
            <button type="button" class="btn btn-outline-primary" id="k8s-output-copy-btn">
              üìã Sao ch√©p
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- End K8s Output Modal -->

    <!-- Scale Workload Modal -->
    <div class="modal fade" id="scale-workload-modal" tabindex="-1" aria-labelledby="scale-workload-modalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="scale-workload-modalLabel">
              üîÑ Scale Workload
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="scale-workload-info" class="form-label">Workload:</label>
              <div id="scale-workload-info" class="alert alert-info mb-0">
                <strong id="scale-workload-name">-</strong>
                <br>
                <small class="text-muted">Type: <span id="scale-workload-type">-</span> | Namespace: <span id="scale-workload-namespace">-</span></small>
              </div>
            </div>
            <div class="mb-3">
              <label for="scale-replicas-input" class="form-label">S·ªë replicas m·ªõi:</label>
              <input type="number" class="form-control" id="scale-replicas-input" min="0" value="1" required>
              <div class="form-text">Nh·∫≠p s·ªë replicas mong mu·ªën (0 ƒë·ªÉ t·∫°m d·ª´ng workload)</div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
              ‚úñÔ∏è H·ªßy
            </button>
            <button type="button" class="btn btn-primary" id="scale-workload-confirm-btn">
              ‚úÖ X√°c nh·∫≠n Scale
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- End Scale Workload Modal -->
  </div>
</div>
<script src="/js/modules/k8sResources.js"></script>
<script src="/js/modules/k8sClusters.js"></script>
</body>
</html>

