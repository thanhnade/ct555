<!doctype html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<body>
<div th:replace="admin/layout :: layout(~{::content})">
  <div th:fragment="content">
    <div class="page-title-row">
      <div>
        <div class="page-title">Qu·∫£n l√Ω ng∆∞·ªùi d√πng</div>
        <div class="page-subtitle">Admin c√≥ th·ªÉ th√™m, s·ª≠a, x√≥a, xem ·ª©ng d·ª•ng c·ªßa ng∆∞·ªùi d√πng.</div>
      </div>
      <button class="btn btn-primary" onclick="window.toggleAccordion(document.getElementById('user-create-accordion'))">+ Th√™m ng∆∞·ªùi d√πng</button>
    </div>

    <!-- Create User Accordion -->
    <div class="accordion" id="user-create-accordion">
      <div class="accordion-header" onclick="window.toggleAccordion(this.parentElement)">
        <span>‚ûï Th√™m ng∆∞·ªùi d√πng m·ªõi</span>
        <span class="arrow">‚Ä∫</span>
      </div>
      <div class="accordion-body">
        <form id="create-user-form">
          <div class="form-grid">
            <div class="form-group">
              <label>H·ªç t√™n <span style="color: #CC0000;">*</span></label>
              <input type="text" name="fullname" id="fullname" placeholder="Nh·∫≠p h·ªç v√† t√™n ƒë·∫ßy ƒë·ªß" required 
                     minlength="2" maxlength="100" autocomplete="name">
              <small class="form-hint">T·ªëi thi·ªÉu 2 k√Ω t·ª±</small>
            </div>
            <div class="form-group">
              <label>T√™n ƒëƒÉng nh·∫≠p <span style="color: #CC0000;">*</span></label>
              <input type="text" name="username" id="username" placeholder="username" required 
                     pattern="[a-zA-Z0-9_]{3,20}" autocomplete="username">
              <small class="form-hint">3-20 k√Ω t·ª±, ch·ªâ ch·ªØ, s·ªë v√† d·∫•u g·∫°ch d∆∞·ªõi</small>
            </div>
            <div class="form-group">
              <label>M·∫≠t kh·∫©u <span style="color: #CC0000;">*</span></label>
              <input type="password" name="password" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required 
                     minlength="6" autocomplete="new-password">
              <small class="form-hint">T·ªëi thi·ªÉu 6 k√Ω t·ª±</small>
            </div>
            <div class="form-group">
              <label>Vai tr√≤ <span style="color: #CC0000;">*</span></label>
              <select name="role" id="role" required>
                <option value="">-- Ch·ªçn vai tr√≤ --</option>
                <option value="USER" selected>USER - Ng∆∞·ªùi d√πng th∆∞·ªùng</option>
                <option value="ADMIN">ADMIN - Qu·∫£n tr·ªã vi√™n</option>
              </select>
              <small class="form-hint">Ch·ªçn quy·ªÅn truy c·∫≠p cho ng∆∞·ªùi d√πng</small>
            </div>
            <div class="form-group">
              <label>G√≥i d·ªãch v·ª• <span style="color: #CC0000;">*</span></label>
              <select name="tier" id="tier" required>
                <option value="STANDARD" selected>STANDARD - G√≥i ti√™u chu·∫©n</option>
                <option value="PREMIUM">PREMIUM - G√≥i cao c·∫•p</option>
              </select>
              <small class="form-hint">Ch·ªçn g√≥i d·ªãch v·ª• cho ng∆∞·ªùi d√πng</small>
            </div>
            <div class="form-group">
              <label>Tr·∫°ng th√°i <span style="color: #CC0000;">*</span></label>
              <select name="status" id="status" required>
                <option value="ACTIVE" selected>ACTIVE - K√≠ch ho·∫°t</option>
                <option value="INACTIVE">INACTIVE - V√¥ hi·ªáu h√≥a</option>
              </select>
              <small class="form-hint">Tr·∫°ng th√°i t√†i kho·∫£n</small>
            </div>
          </div>
          <div id="form-error" class="form-error" style="display: none; margin-top: 12px; padding: 10px; background: #fecaca; border: 1px solid #f87171; border-radius: 6px; color: #991b1b; font-size: 13px;"></div>
          <div style="margin-top: 12px; display: flex; gap: 8px; align-items: center;">
            <button type="submit" class="btn btn-primary" id="submit-btn">
              <span id="submit-text">üíæ L∆∞u ng∆∞·ªùi d√πng</span>
              <span id="submit-loading" style="display: none;">‚è≥ ƒêang t·∫°o...</span>
            </button>
            <button type="button" class="btn" onclick="resetUserForm()">üîÑ ƒê·∫∑t l·∫°i</button>
            <button type="button" class="btn" onclick="window.toggleAccordion(document.getElementById('user-create-accordion'))">‚úñÔ∏è H·ªßy</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Users List -->
    <div class="table-card">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
        <div style="font-size: 15px; font-weight: 600; color: #003366;">Danh s√°ch ng∆∞·ªùi d√πng</div>
        <div style="display: flex; gap: 8px;">
          <button class="btn" id="refresh-users-btn">üîÑ L√†m m·ªõi</button>
          <button class="btn" id="export-users-btn">üì• Xu·∫•t CSV</button>
        </div>
      </div>
      <table class="table">
        <thead>
          <tr>
            <th>Username</th>
            <th>H·ªç t√™n</th>
            <th>Role</th>
            <th>Tr·∫°ng th√°i</th>
            <th>Ng√†y t·∫°o</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="users-tbody"></tbody>
      </table>
    </div>

    <!-- Edit User Modal -->
    <div id="editUserPopup" class="popup-backdrop" style="display: none;">
      <div class="popup-box" style="width: 600px; max-height: 85vh; overflow: hidden; display: flex; flex-direction: column;">
        <div class="popup-header" id="edit-user-title">‚úèÔ∏è S·ª≠a th√¥ng tin ng∆∞·ªùi d√πng</div>
        <div style="padding: 20px; overflow-y: auto; max-height: 60vh; background: #FFFFFF; color: #333333;">
          <form id="edit-user-form">
            <input type="hidden" id="edit-user-id">
            <div class="form-grid">
              <div class="form-group">
                <label>H·ªç t√™n <span style="color: #CC0000;">*</span></label>
                <input type="text" id="edit-user-fullname" name="fullname" placeholder="Nh·∫≠p h·ªç v√† t√™n ƒë·∫ßy ƒë·ªß" required 
                       minlength="2" maxlength="100" autocomplete="name">
                <small class="form-hint">T·ªëi thi·ªÉu 2 k√Ω t·ª±</small>
              </div>
              <div class="form-group">
                <label>Username</label>
                <input type="text" id="edit-user-username" name="username" readonly 
                       style="background: #F2F2F2; cursor: not-allowed;" autocomplete="username">
                <small class="form-hint">Username kh√¥ng th·ªÉ thay ƒë·ªïi</small>
              </div>
              <div class="form-group">
                <label>Vai tr√≤ <span style="color: #CC0000;">*</span></label>
                <select id="edit-user-role" name="role" required>
                  <option value="">-- Ch·ªçn vai tr√≤ --</option>
                  <option value="USER">USER - Ng∆∞·ªùi d√πng th∆∞·ªùng</option>
                  <option value="ADMIN">ADMIN - Qu·∫£n tr·ªã vi√™n</option>
                </select>
                <small class="form-hint">Ch·ªçn quy·ªÅn truy c·∫≠p cho ng∆∞·ªùi d√πng</small>
              </div>
              <div class="form-group">
                <label>G√≥i d·ªãch v·ª• <span style="color: #CC0000;">*</span></label>
                <select id="edit-user-tier" name="tier" required>
                  <option value="STANDARD">STANDARD - G√≥i ti√™u chu·∫©n</option>
                  <option value="PREMIUM">PREMIUM - G√≥i cao c·∫•p</option>
                </select>
                <small class="form-hint">Ch·ªçn g√≥i d·ªãch v·ª• cho ng∆∞·ªùi d√πng</small>
              </div>
              <div class="form-group">
                <label>Tr·∫°ng th√°i <span style="color: #CC0000;">*</span></label>
                <select id="edit-user-status" name="status" required>
                  <option value="ACTIVE">ACTIVE - K√≠ch ho·∫°t</option>
                  <option value="INACTIVE">INACTIVE - V√¥ hi·ªáu h√≥a</option>
                </select>
                <small class="form-hint">Tr·∫°ng th√°i t√†i kho·∫£n</small>
              </div>
            </div>
            <div id="edit-form-error" class="form-error" style="display: none; margin-top: 12px;"></div>
          </form>
        </div>
        <div class="popup-actions">
          <button type="button" class="btn" onclick="window.closeEditUserPopup()">‚úñÔ∏è H·ªßy</button>
          <button type="button" class="btn btn-primary" id="save-edit-user-btn" onclick="window.UsersModule.saveEditUser()">
            <span id="save-edit-text">üíæ L∆∞u thay ƒë·ªïi</span>
            <span id="save-edit-loading" style="display: none;">‚è≥ ƒêang l∆∞u...</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Reset Password Modal -->
    <div id="resetPasswordPopup" class="popup-backdrop" style="display: none;">
      <div class="popup-box" style="width: 450px; max-height: 85vh; overflow: hidden; display: flex; flex-direction: column;">
        <div class="popup-header" id="reset-password-title">üîë ƒê·∫∑t l·∫°i m·∫≠t kh·∫©u</div>
        <div style="padding: 20px; overflow-y: auto; max-height: 60vh; background: #FFFFFF; color: #333333;">
          <form id="reset-password-form">
            <input type="hidden" id="reset-password-user-id">
            <div class="form-group">
              <label>Username</label>
              <input type="text" id="reset-password-username" readonly 
                     style="background: #F2F2F2; cursor: not-allowed;" autocomplete="username">
              <small class="form-hint">Ng∆∞·ªùi d√πng c·∫ßn ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u</small>
            </div>
            <div class="form-group">
              <label>M·∫≠t kh·∫©u m·ªõi <span style="color: #CC0000;">*</span></label>
              <input type="password" id="reset-password-new" name="password" placeholder="Nh·∫≠p m·∫≠t kh·∫©u m·ªõi" required 
                     minlength="6" autocomplete="new-password">
              <small class="form-hint">T·ªëi thi·ªÉu 6 k√Ω t·ª±</small>
            </div>
            <div class="form-group">
              <label>X√°c nh·∫≠n m·∫≠t kh·∫©u <span style="color: #CC0000;">*</span></label>
              <input type="password" id="reset-password-confirm" name="passwordConfirm" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u" required 
                     minlength="6" autocomplete="new-password">
              <small class="form-hint">Nh·∫≠p l·∫°i m·∫≠t kh·∫©u ƒë·ªÉ x√°c nh·∫≠n</small>
            </div>
            <div id="reset-password-error" class="form-error" style="display: none; margin-top: 12px;"></div>
          </form>
        </div>
        <div class="popup-actions">
          <button type="button" class="btn" onclick="window.closeResetPasswordPopup()">‚úñÔ∏è H·ªßy</button>
          <button type="button" class="btn btn-primary" id="save-reset-password-btn" onclick="window.UsersModule.saveResetPassword()">
            <span id="save-reset-text">üíæ ƒê·∫∑t l·∫°i m·∫≠t kh·∫©u</span>
            <span id="save-reset-loading" style="display: none;">‚è≥ ƒêang l∆∞u...</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Activity Modal -->
    <div id="activityPopup" class="popup-backdrop" style="display: none;">
      <div class="popup-box" style="width: 700px; max-height: 85vh; overflow: hidden; display: flex; flex-direction: column;">
        <div class="popup-header" id="activity-title">üìà L·ªãch s·ª≠ ho·∫°t ƒë·ªông</div>
        <div style="padding: 15px; overflow-y: auto; max-height: 60vh; background: #FFFFFF; color: #333333;">
          <ul id="activity-list" style="list-style: none; padding: 0; margin: 0;"></ul>
        </div>
        <div class="popup-actions">
          <button class="btn-close" onclick="window.closeActivityPopup()">ƒê√≥ng</button>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="/js/modules/users.js"></script>
</body>
</html>


