<!doctype html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<body>
<div th:replace="admin/layout :: layout(~{::content})">
  <div th:fragment="content">
    <div class="page-title-row">
      <div>
        <div class="page-title">üñ• Qu·∫£n l√Ω Server</div>
        <div class="page-subtitle">Danh s√°ch c√°c server ƒë∆∞·ª£c AutoDeployApp qu·∫£n l√Ω. Admin c√≥ th·ªÉ th√™m, s·ª≠a, x√≥a, k·∫øt n·ªëi server.</div>
    </div>
      <div class="d-flex gap-2">
        <button class="btn" id="refresh-servers-btn">üîÑ L√†m m·ªõi</button>
        <button class="btn" id="check-status-btn">üîç Ki·ªÉm tra tr·∫°ng th√°i</button>
        <button class="btn btn-success" id="refresh-all-metrics-btn">üìä C·∫≠p nh·∫≠t Metrics t·∫•t c·∫£</button>
        <button class="btn btn-primary" id="add-server-btn" onclick="window.ServersModule.openAddServerModal()">+ Th√™m Server</button>
      </div>
    </div>

    <!-- Servers List - Grid Layout -->
    <div class="servers-grid-container mt-4">
      <div id="servers-grid" class="row g-3">
        <div class="col-12 text-center text-muted p-4">ƒêang t·∫£i...</div>
      </div>
    </div>

    <!-- Add Server Modal -->
    <div class="modal fade" id="addServerModal" tabindex="-1" aria-labelledby="addServerModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="addServerModalLabel">‚ûï Th√™m Server</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="add-server-form">
              <div class="form-grid">
                <div class="form-group">
                  <label>Host/IP <span class="text-danger">*</span></label>
                  <input type="text" id="add-server-host" name="host" placeholder="192.168.1.100" required 
                         pattern="^([0-9]{1,3}\.){3}[0-9]{1,3}$|^[a-zA-Z0-9.\-]+$" autocomplete="off" class="form-control">
                  <small class="form-hint">ƒê·ªãa ch·ªâ IP ho·∫∑c hostname</small>
                </div>
                <div class="form-group">
                  <label>Port <span class="text-danger">*</span></label>
                  <input type="number" id="add-server-port" name="port" value="22" min="1" max="65535" required class="form-control">
                  <small class="form-hint">Port SSH (m·∫∑c ƒë·ªãnh: 22)</small>
                </div>
                <div class="form-group">
                  <label>Username <span class="text-danger">*</span></label>
                  <input type="text" id="add-server-username" name="username" placeholder="root ho·∫∑c ubuntu" required 
                         autocomplete="username" class="form-control">
                  <small class="form-hint">T√™n ng∆∞·ªùi d√πng SSH</small>
                </div>
                <div class="form-group">
                  <label>Password <span class="text-danger">*</span></label>
                  <input type="password" id="add-server-password" name="password" placeholder="M·∫≠t kh·∫©u SSH" required 
                         autocomplete="new-password" class="form-control">
                  <small class="form-hint">M·∫≠t kh·∫©u ƒë·ªÉ k·∫øt n·ªëi l·∫ßn ƒë·∫ßu v√† t·∫°o SSH key</small>
                </div>
                <div class="form-group">
                  <label>Role <span class="text-danger">*</span></label>
                  <select id="add-server-role" name="role" class="form-control" required>
                    <option value="WORKER" selected>WORKER</option>
                    <option value="MASTER">MASTER</option>
                    <option value="DOCKER">DOCKER</option>
                    <option value="DATABASE">DATABASE</option>
                    <option value="ANSIBLE">ANSIBLE</option>
                  </select>
                  <small class="form-hint">Vai tr√≤ c·ªßa server trong h·ªá th·ªëng</small>
                </div>
                <div class="form-group">
                  <label>Cluster Status <span class="text-danger">*</span></label>
                  <select id="add-server-cluster-status" name="clusterStatus" class="form-control" required>
                    <option value="UNAVAILABLE" selected>UNAVAILABLE</option>
                    <option value="AVAILABLE">AVAILABLE</option>
                  </select>
                  <small class="form-hint">Set AVAILABLE ƒë·ªÉ th√™m server v√†o cluster</small>
                </div>
              </div>
              <div id="add-server-error" class="form-error d-none mt-3"></div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">‚úñÔ∏è H·ªßy</button>
            <button type="button" class="btn btn-primary" id="save-add-server-btn" onclick="window.ServersModule.saveAddServer()">
              <span id="save-add-text">üíæ Th√™m Server</span>
              <span id="save-add-loading" class="d-none">‚è≥ ƒêang th√™m...</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Edit Server Modal -->
    <div class="modal fade" id="editServerModal" tabindex="-1" aria-labelledby="editServerModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="editServerModalLabel">‚úèÔ∏è S·ª≠a Server</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="edit-server-form">
              <input type="hidden" id="edit-server-id">
              <div class="form-grid">
                <div class="form-group">
                  <label>Host/IP <span class="text-danger">*</span></label>
                  <input type="text" id="edit-server-host" name="host" placeholder="192.168.1.100" required 
                         pattern="^([0-9]{1,3}\.){3}[0-9]{1,3}$|^[a-zA-Z0-9.\-]+$" autocomplete="off" class="form-control">
                  <small class="form-hint">ƒê·ªãa ch·ªâ IP ho·∫∑c hostname</small>
                </div>
                <div class="form-group">
                  <label>Port <span class="text-danger">*</span></label>
                  <input type="number" id="edit-server-port" name="port" min="1" max="65535" required class="form-control">
                  <small class="form-hint">Port SSH (m·∫∑c ƒë·ªãnh: 22)</small>
                </div>
                <div class="form-group">
                  <label>Username <span class="text-danger">*</span></label>
                  <input type="text" id="edit-server-username" name="username" placeholder="root ho·∫∑c ubuntu" required 
                         autocomplete="username" class="form-control">
                  <small class="form-hint">T√™n ng∆∞·ªùi d√πng SSH</small>
                </div>
                <div class="form-group">
                  <label>Password</label>
                  <input type="password" id="edit-server-password" name="password" placeholder="ƒê·ªÉ tr·ªëng n·∫øu kh√¥ng ƒë·ªïi" 
                         autocomplete="new-password" class="form-control">
                  <small class="form-hint">Ch·ªâ nh·∫≠p n·∫øu mu·ªën ƒë·ªïi m·∫≠t kh·∫©u</small>
                </div>
                <div class="form-group">
                  <label>Role <span class="text-danger">*</span></label>
                  <select id="edit-server-role" name="role" class="form-control" required>
                    <option value="WORKER">WORKER</option>
                    <option value="MASTER">MASTER</option>
                    <option value="DOCKER">DOCKER</option>
                    <option value="DATABASE">DATABASE</option>
                    <option value="ANSIBLE">ANSIBLE</option>
                  </select>
                  <small class="form-hint">Vai tr√≤ c·ªßa server trong h·ªá th·ªëng</small>
                </div>
                <div class="form-group">
                  <label>Cluster Status <span class="text-danger">*</span></label>
                  <select id="edit-server-cluster-status" name="clusterStatus" class="form-control" required>
                    <option value="UNAVAILABLE">UNAVAILABLE</option>
                    <option value="AVAILABLE">AVAILABLE</option>
                  </select>
                  <small class="form-hint">Set AVAILABLE ƒë·ªÉ th√™m server v√†o cluster</small>
                </div>
                <div class="form-group">
                  <label>Tr·∫°ng th√°i</label>
                  <select id="edit-server-status" name="status" class="form-control">
                    <option value="ONLINE">ONLINE</option>
                    <option value="OFFLINE">OFFLINE</option>
                  </select>
                  <small class="form-hint">Tr·∫°ng th√°i server</small>
                </div>
              </div>
              <div id="edit-server-error" class="form-error d-none mt-3"></div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">‚úñÔ∏è H·ªßy</button>
            <button type="button" class="btn btn-primary" id="save-edit-server-btn" onclick="window.ServersModule.saveEditServer()">
              <span id="save-edit-text">üíæ L∆∞u thay ƒë·ªïi</span>
              <span id="save-edit-loading" class="d-none">‚è≥ ƒêang l∆∞u...</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Reconnect Server Modal -->
    <div class="modal fade" id="reconnectServerModal" tabindex="-1" aria-labelledby="reconnectServerModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="reconnectServerModalLabel">üîå K·∫øt n·ªëi l·∫°i Server</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="reconnect-server-form">
              <input type="hidden" id="reconnect-server-id">
              <div class="form-group">
                <label>Host</label>
                <input type="text" id="reconnect-server-host" readonly 
                       class="form-control bg-light" autocomplete="off">
              </div>
              <div class="form-group">
                <label>Password <span class="text-danger">*</span></label>
                <input type="password" id="reconnect-server-password" name="password" placeholder="Nh·∫≠p m·∫≠t kh·∫©u SSH" required 
                       autocomplete="current-password" class="form-control">
                <small class="form-hint">Nh·∫≠p m·∫≠t kh·∫©u ƒë·ªÉ k·∫øt n·ªëi l·∫°i (SSH key kh√¥ng kh·∫£ d·ª•ng)</small>
            </div>
              <div id="reconnect-server-error" class="form-error d-none mt-3"></div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">‚úñÔ∏è H·ªßy</button>
            <button type="button" class="btn btn-primary" id="save-reconnect-btn" onclick="window.ServersModule.saveReconnect()">
              <span id="save-reconnect-text">üîå K·∫øt n·ªëi</span>
              <span id="save-reconnect-loading" class="d-none">‚è≥ ƒêang k·∫øt n·ªëi...</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Terminal Modal -->
    <div class="modal fade" id="terminalModal" tabindex="-1" aria-labelledby="terminalModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-fullscreen-lg-down modal-xl">
        <div class="modal-content terminal-modal-content">
          <div class="modal-header terminal-modal-header">
            <h5 class="modal-title text-white" id="terminalModalLabel">üíª Terminal - <span id="terminal-title">Server</span></h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body terminal-modal-body">
            <form id="term-connection-form" onsubmit="return false;">
              <div class="terminal-info-grid mb-3">
                <div class="terminal-info-item">
                  <label class="terminal-label">Host/IP</label>
                  <input id="term-host" class="form-control terminal-input" placeholder="Host" readonly>
                </div>
                <div class="terminal-info-item">
                  <label class="terminal-label">Port</label>
                  <input id="term-port" type="number" class="form-control terminal-input" placeholder="Port" readonly>
                </div>
                <div class="terminal-info-item">
                  <label class="terminal-label">Username</label>
                  <input id="term-user" name="username" class="form-control terminal-input" placeholder="Username" readonly autocomplete="username">
                </div>
                <div class="terminal-info-item">
                  <label class="terminal-label">Password</label>
                  <input id="term-pass" type="password" name="password" class="form-control terminal-input" placeholder="Nh·∫≠p password n·∫øu SSH key kh√¥ng kh·∫£ d·ª•ng" autocomplete="current-password">
                  <small class="text-muted" style="font-size: 11px; display: block; margin-top: 4px;">S·∫Ω th·ª≠ SSH key tr∆∞·ªõc, n·∫øu kh√¥ng ƒë∆∞·ª£c s·∫Ω d√πng password</small>
                </div>
              </div>
            </form>
            <div id="term-output" class="terminal-box flex-fill"></div>
          </div>
          <div class="modal-footer terminal-modal-footer">
            <button id="term-connect-btn" type="button" class="btn btn-primary text-nowrap">üîå K·∫øt n·ªëi</button>
            <form id="term-input-form" class="d-flex flex-fill gap-2 m-0">
              <input id="term-input" class="form-control terminal-command-input" placeholder="Nh·∫≠p l·ªánh v√† nh·∫•n Enter ƒë·ªÉ g·ª≠i" autocomplete="off">
              <button class="btn btn-primary text-nowrap" type="submit">‚ñ∂Ô∏è G·ª≠i</button>
            </form>
            <button type="button" class="btn btn-secondary text-nowrap" data-bs-dismiss="modal">‚úñÔ∏è ƒê√≥ng</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="/js/modules/servers.js"></script>
</body>
</html>
