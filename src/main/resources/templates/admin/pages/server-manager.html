<!doctype html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<body>
<div th:replace="admin/layout :: layout(~{::content})">
  <div th:fragment="content">
    <div class="page-title-row">
      <div>
        <div class="page-title">üñ• Qu·∫£n l√Ω Server</div>
        <div class="page-subtitle">Danh s√°ch c√°c server ƒë∆∞·ª£c AutoDeployApp qu·∫£n l√Ω. Admin c√≥ th·ªÉ th√™m, s·ª≠a, x√≥a, k·∫øt n·ªëi server.</div>
      </div>
      <div style="display: flex; gap: 8px;">
        <button class="btn" id="refresh-servers-btn">üîÑ L√†m m·ªõi</button>
        <button class="btn" id="check-status-btn">üîç Ki·ªÉm tra tr·∫°ng th√°i</button>
        <button class="btn btn-primary" onclick="window.location.href='/admin/server/add'">+ Th√™m Server</button>
      </div>
    </div>

    <!-- Servers List -->
    <div class="table-card">
      <table class="table">
            <thead>
            <tr>
              <th>Host</th>
              <th>Port</th>
              <th>Username</th>
            <th>Tr·∫°ng th√°i</th>
            <th>Actions</th>
            </tr>
            </thead>
        <tbody id="servers-tbody">
          <tr>
            <td colspan="5" class="text-center" style="color: #666666; padding: 20px;">ƒêang t·∫£i...</td>
          </tr>
        </tbody>
          </table>
        </div>

    <!-- Edit Server Modal -->
    <div id="editServerPopup" class="popup-backdrop" style="display: none;">
      <div class="popup-box" style="width: 550px; max-height: 85vh; overflow: hidden; display: flex; flex-direction: column;">
        <div class="popup-header" id="edit-server-title">‚úèÔ∏è S·ª≠a Server</div>
        <div style="padding: 20px; overflow-y: auto; max-height: 60vh; background: #FFFFFF; color: #333333;">
          <form id="edit-server-form">
            <input type="hidden" id="edit-server-id">
            <div class="form-grid">
              <div class="form-group">
                <label>Host/IP <span style="color: #CC0000;">*</span></label>
                <input type="text" id="edit-server-host" name="host" placeholder="192.168.1.100" required 
                       pattern="^([0-9]{1,3}\.){3}[0-9]{1,3}$|^[a-zA-Z0-9.-]+$" autocomplete="off">
                <small class="form-hint">ƒê·ªãa ch·ªâ IP ho·∫∑c hostname</small>
              </div>
              <div class="form-group">
                <label>Port <span style="color: #CC0000;">*</span></label>
                <input type="number" id="edit-server-port" name="port" min="1" max="65535" required>
                <small class="form-hint">Port SSH (m·∫∑c ƒë·ªãnh: 22)</small>
              </div>
              <div class="form-group">
                <label>Username <span style="color: #CC0000;">*</span></label>
                <input type="text" id="edit-server-username" name="username" placeholder="root ho·∫∑c ubuntu" required 
                       autocomplete="username">
                <small class="form-hint">T√™n ng∆∞·ªùi d√πng SSH</small>
              </div>
              <div class="form-group">
                <label>Password</label>
                <input type="password" id="edit-server-password" name="password" placeholder="ƒê·ªÉ tr·ªëng n·∫øu kh√¥ng ƒë·ªïi" 
                       autocomplete="new-password">
                <small class="form-hint">Ch·ªâ nh·∫≠p n·∫øu mu·ªën ƒë·ªïi m·∫≠t kh·∫©u</small>
              </div>
              <div class="form-group">
                <label>Tr·∫°ng th√°i</label>
                <select id="edit-server-status" name="status" class="form-group select" style="width: 100%;">
                  <option value="ONLINE">ONLINE</option>
                  <option value="OFFLINE">OFFLINE</option>
                </select>
                <small class="form-hint">Tr·∫°ng th√°i server</small>
              </div>
            </div>
            <div id="edit-server-error" class="form-error" style="display: none; margin-top: 12px;"></div>
          </form>
        </div>
        <div class="popup-actions">
          <button type="button" class="btn" onclick="window.ServersModule.closeEditServerPopup()">‚úñÔ∏è H·ªßy</button>
          <button type="button" class="btn btn-primary" id="save-edit-server-btn" onclick="window.ServersModule.saveEditServer()">
            <span id="save-edit-text">üíæ L∆∞u thay ƒë·ªïi</span>
            <span id="save-edit-loading" style="display: none;">‚è≥ ƒêang l∆∞u...</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Reconnect Server Modal -->
    <div id="reconnectServerPopup" class="popup-backdrop" style="display: none;">
      <div class="popup-box" style="width: 450px; max-height: 85vh; overflow: hidden; display: flex; flex-direction: column;">
        <div class="popup-header" id="reconnect-server-title">üîå K·∫øt n·ªëi l·∫°i Server</div>
        <div style="padding: 20px; overflow-y: auto; max-height: 60vh; background: #FFFFFF; color: #333333;">
          <form id="reconnect-server-form">
            <input type="hidden" id="reconnect-server-id">
            <div class="form-group">
              <label>Host</label>
              <input type="text" id="reconnect-server-host" readonly 
                     style="background: #F2F2F2; cursor: not-allowed;" autocomplete="off">
            </div>
            <div class="form-group">
              <label>Password <span style="color: #CC0000;">*</span></label>
              <input type="password" id="reconnect-server-password" name="password" placeholder="Nh·∫≠p m·∫≠t kh·∫©u SSH" required 
                     autocomplete="current-password">
              <small class="form-hint">Nh·∫≠p m·∫≠t kh·∫©u ƒë·ªÉ k·∫øt n·ªëi l·∫°i (SSH key kh√¥ng kh·∫£ d·ª•ng)</small>
            </div>
            <div id="reconnect-server-error" class="form-error" style="display: none; margin-top: 12px;"></div>
          </form>
        </div>
        <div class="popup-actions">
          <button type="button" class="btn" onclick="window.ServersModule.closeReconnectServerPopup()">‚úñÔ∏è H·ªßy</button>
          <button type="button" class="btn btn-primary" id="save-reconnect-btn" onclick="window.ServersModule.saveReconnect()">
            <span id="save-reconnect-text">üîå K·∫øt n·ªëi</span>
            <span id="save-reconnect-loading" style="display: none;">‚è≥ ƒêang k·∫øt n·ªëi...</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Terminal Modal -->
    <div id="terminalModal" class="popup-backdrop" style="display: none;">
      <div class="popup-box terminal-popup" style="width: 90vw; max-width: 1200px; max-height: 90vh; overflow: hidden; display: flex; flex-direction: column; background: #FFFFFF;">
        <div class="popup-header" style="background: #003366; color: #FFFFFF; border-bottom: 2px solid #004080; padding: 16px 20px;">
          <span style="font-size: 16px; font-weight: 600;">üíª Terminal - <span id="terminal-title">Server</span></span>
          <button type="button" class="btn-close-terminal" onclick="window.ServersModule.closeTerminal()" style="float: right; border: none; background: transparent; color: #FFFFFF; font-size: 22px; cursor: pointer; padding: 0; width: 28px; height: 28px; border-radius: 4px; display: flex; align-items: center; justify-content: center; transition: background 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='transparent'">‚úï</button>
        </div>
        <div style="padding: 16px; background: #F8F9FA; flex: 1; overflow: hidden; display: flex; flex-direction: column; border-bottom: 1px solid #E0E0E0;">
          <div class="terminal-info-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-bottom: 12px;">
            <div class="terminal-info-item">
              <label style="display: block; font-size: 11px; color: #666666; margin-bottom: 4px; font-weight: 600;">Host/IP</label>
              <input id="term-host" class="terminal-input" placeholder="Host" readonly>
            </div>
            <div class="terminal-info-item">
              <label style="display: block; font-size: 11px; color: #666666; margin-bottom: 4px; font-weight: 600;">Port</label>
              <input id="term-port" type="number" class="terminal-input" placeholder="Port" readonly>
            </div>
            <div class="terminal-info-item">
              <label style="display: block; font-size: 11px; color: #666666; margin-bottom: 4px; font-weight: 600;">Username</label>
              <input id="term-user" class="terminal-input" placeholder="Username" readonly>
          </div>
            <div class="terminal-info-item">
              <label style="display: block; font-size: 11px; color: #666666; margin-bottom: 4px; font-weight: 600;">Password (t√πy ch·ªçn)</label>
              <input id="term-pass" type="password" class="terminal-input" placeholder="Nh·∫≠p password n·∫øu c·∫ßn">
            </div>
          </div>
          <div id="term-output" class="terminal-box"></div>
              </div>
        <div class="terminal-footer" style="background: #FFFFFF; border-top: 1px solid #E0E0E0; padding: 12px 16px; display: flex; gap: 10px; align-items: center;">
          <button id="term-connect-btn" type="button" class="btn btn-primary" style="white-space: nowrap;">üîå K·∫øt n·ªëi</button>
          <form id="term-input-form" style="flex: 1; display: flex; gap: 8px; margin: 0;">
            <input id="term-input" class="terminal-command-input" placeholder="Nh·∫≠p l·ªánh v√† nh·∫•n Enter ƒë·ªÉ g·ª≠i" autocomplete="off">
            <button class="btn btn-primary" type="submit" style="white-space: nowrap;">‚ñ∂Ô∏è G·ª≠i</button>
            </form>
          <button type="button" class="btn" onclick="window.ServersModule.closeTerminal()" style="white-space: nowrap;">‚úñÔ∏è ƒê√≥ng</button>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="/js/modules/servers.js"></script>
</body>
</html>
