<!doctype html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<body>
<div th:replace="admin/layout :: layout(~{::content})">
  <div th:fragment="content">
    <div class="page-title-row">
      <div>
        <div class="page-title">Y√™u c·∫ßu duy·ªát ·ª©ng d·ª•ng</div>
        <div class="page-subtitle">Admin ki·ªÉm tra v√† cho ph√©p tri·ªÉn khai ·ª©ng d·ª•ng.</div>
      </div>
      <div style="display: flex; gap: 8px; align-items: center;">
        <select id="deployment-status-filter" class="form-group select" style="width: auto; min-width: 150px;" onchange="loadDeploymentRequests()">
          <option value="">T·∫•t c·∫£</option>
          <option value="PENDING">‚è≥ Ch·ªù x·ª≠ l√Ω</option>
          <option value="RUNNING">‚úÖ ƒêang ch·∫°y</option>
          <option value="ERROR">‚ùå L·ªói</option>
        </select>
        <button class="btn" onclick="loadDeploymentRequests()">üîÑ L√†m m·ªõi</button>
      </div>
    </div>

    <div class="table-card">
      <table class="table">
        <thead>
          <tr>
            <th>App</th>
            <th>User</th>
            <th>Ng√†y upload</th>
            <th>Docker Image</th>
            <th>Tr·∫°ng th√°i</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="deployment-requests-tbody">
          <tr>
            <td colspan="6" class="text-center" style="color: #666666; padding: 20px;">ƒêang t·∫£i...</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Logs section - Hidden by default, shown when viewing logs -->
    <div class="table-card" id="deployment-logs-section" style="display: none; margin-top: 16px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
        <div style="font-size: 15px; font-weight: 600; color: #003366;">üìã Logs tri·ªÉn khai</div>
        <button class="btn" id="clear-deployment-logs-btn" onclick="clearDeploymentLogs()">üóëÔ∏è X√≥a log</button>
      </div>
      <div id="deployment-logs-console" class="terminal-box" style="padding: 12px; height: 400px; overflow: auto; font-family: 'Courier New', monospace; font-size: 12px; white-space: pre-wrap; color: #e5e7eb;">
        <div style="color: #666666; text-align: center;">Ch·ªçn m·ªôt deployment request ƒë·ªÉ xem logs...</div>
      </div>
    </div>

    <!-- App Modals -->
    <div class="modal fade" id="appFormModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">·ª®ng d·ª•ng</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="app-form" class="row g-2">
              <input type="hidden" id="app-id">
              <div class="col-md-4">
                <label class="form-label small">T√™n</label>
                <input id="app-name" class="form-control form-control-sm" placeholder="my-app">
              </div>
              <div class="col-md-4">
                <label class="form-label small">Chart</label>
                <input id="app-chart" class="form-control form-control-sm" placeholder="bitnami/nginx">
              </div>
              <div class="col-md-4">
                <label class="form-label small">Chart Version</label>
                <input id="app-chart-version" class="form-control form-control-sm" placeholder="">
              </div>
              <div class="col-md-5">
                <label class="form-label small">Image Repository</label>
                <input id="app-image-repo" class="form-control form-control-sm" placeholder="nginx">
              </div>
              <div class="col-md-3">
                <label class="form-label small">Image Tag</label>
                <input id="app-image-tag" class="form-control form-control-sm" placeholder="1.27.2">
              </div>
              <div class="col-md-2">
                <label class="form-label small">Namespace</label>
                <input id="app-namespace" class="form-control form-control-sm" placeholder="default">
              </div>
              <div class="col-md-4">
                <label class="form-label small">Cluster</label>
                <select id="app-cluster-id" class="form-select form-select-sm">
                  <option value="">-- Ch·ªçn Cluster --</option>
                </select>
              </div>
              <div class="col-md-4">
                <label class="form-label small">Release Name</label>
                <input id="app-release-name" class="form-control form-control-sm" placeholder="my-app">
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
            <button type="button" class="btn btn-primary" onclick="saveApp()">L∆∞u</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="appDeployModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Tri·ªÉn khai ·ª®ng d·ª•ng</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="deploy-form" onsubmit="return false;">
              <input type="hidden" id="deploy-app-id">
              <div class="row g-2 mb-2">
                <div class="col-md-4">
                  <label class="form-label small">Phi√™n b·∫£n (image tag)</label>
                  <input id="deploy-version" name="version" class="form-control form-control-sm" placeholder="1.2.3">
                </div>
                <div class="col-md-4">
                  <label class="form-label small">Chi·∫øn l∆∞·ª£c</label>
                  <select id="deploy-strategy" name="strategy" class="form-select form-select-sm">
                    <option value="ROLLING">ROLLING</option>
                  </select>
                </div>
                <div class="col-md-4">
                  <label class="form-label small">Sudo Password (n·∫øu c·∫ßn)</label>
                  <input id="deploy-sudo" name="sudoPassword" class="form-control form-control-sm" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password">
                </div>
                <div class="col-12">
                  <label class="form-label small">Values override (t√πy ch·ªçn)</label>
                  <textarea id="deploy-values" name="values" class="form-control form-control-sm" rows="3" placeholder="key=value ho·∫∑c YAML"></textarea>
                </div>
              </div>
            </form>
            <div class="card">
              <div class="card-header d-flex justify-content-between align-items-center">
                <span class="small">Log tri·ªÉn khai</span>
                <button class="btn btn-sm btn-outline-secondary" onclick="clearDeployLog()">X√≥a log</button>
              </div>
              <div class="card-body p-0">
                <pre id="deploy-log" class="m-0 p-3 bg-dark text-light h-280px monospace-12 overflow-auto"></pre>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
            <button type="button" class="btn btn-success" onclick="startDeployWS()">Tri·ªÉn khai</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="/js/modules/deploymentRequests.js"></script>
</body>
</html>


