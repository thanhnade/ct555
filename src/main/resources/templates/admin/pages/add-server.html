<!doctype html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<body>
<div th:replace="admin/layout :: layout(~{::content})">
  <div th:fragment="content">
    <div class="page-title-row">
      <div>
        <div class="page-title">â• ThÃªm Server</div>
        <div class="page-subtitle">ThÃªm server má»›i vÃ o há»‡ thá»‘ng AutoDeployApp Ä‘á»ƒ quáº£n lÃ½ vÃ  sá»­ dá»¥ng.</div>
      </div>
      <div style="display: flex; gap: 8px;">
        <button class="btn" onclick="window.location.href='/admin/server'">â† Quay láº¡i danh sÃ¡ch</button>
      </div>
    </div>

    <div class="table-card">
      <form id="create-server-form">
        <div class="form-grid">
          <div class="form-group">
            <label>Host/IP <span style="color: #CC0000;">*</span></label>
            <input type="text" name="host" id="server-host" placeholder="192.168.1.100" required 
                   pattern="^([0-9]{1,3}\.){3}[0-9]{1,3}$|^[a-zA-Z0-9.-]+$" autocomplete="off">
            <small class="form-hint">Äá»‹a chá»‰ IP hoáº·c hostname</small>
          </div>
          <div class="form-group">
            <label>Port <span style="color: #CC0000;">*</span></label>
            <input type="number" name="port" id="server-port" value="22" min="1" max="65535" required>
            <small class="form-hint">Port SSH (máº·c Ä‘á»‹nh: 22)</small>
          </div>
          <div class="form-group">
            <label>Username <span style="color: #CC0000;">*</span></label>
            <input type="text" name="username" id="server-username" placeholder="root hoáº·c ubuntu" required 
                   autocomplete="username">
            <small class="form-hint">TÃªn ngÆ°á»i dÃ¹ng SSH</small>
          </div>
          <div class="form-group">
            <label>Password <span style="color: #CC0000;">*</span></label>
            <input type="password" name="password" id="server-password" placeholder="Máº­t kháº©u SSH" required 
                   autocomplete="new-password">
            <small class="form-hint">Máº­t kháº©u Ä‘á»ƒ káº¿t ná»‘i láº§n Ä‘áº§u vÃ  táº¡o SSH key</small>
          </div>
        </div>
        <div id="create-server-error" class="form-error" style="display: none; margin-top: 12px;"></div>
        <div style="margin-top: 16px; display: flex; gap: 8px;">
          <button type="submit" class="btn btn-primary" id="create-server-submit-btn">
            <span id="create-server-text">ğŸ’¾ ThÃªm Server</span>
            <span id="create-server-loading" style="display: none;">â³ Äang thÃªm...</span>
          </button>
          <button type="button" class="btn" onclick="window.location.href='/admin/server'">âœ–ï¸ Há»§y</button>
        </div>
      </form>
    </div>
  </div>
</div>
<script src="/js/modules/servers.js"></script>
<script>
  // Initialize form for add-server page
  (function() {
    const form = document.getElementById('create-server-form');
    if (form && !form.dataset.bound) {
      form.dataset.bound = '1';
      form.addEventListener('submit', async function(e) {
        e.preventDefault();
        if (window.ServersModule && window.ServersModule.createServer) {
          try {
            await window.ServersModule.createServer(e);
            // Redirect to server list on success (if no error displayed)
            const errorEl = document.getElementById('create-server-error');
            if (!errorEl || errorEl.style.display === 'none' || !errorEl.textContent.trim()) {
              setTimeout(() => {
                window.location.href = '/admin/server';
              }, 1000);
            }
          } catch (err) {
            console.error('Error creating server:', err);
          }
        }
      });
    }
  })();
</script>
</body>
</html>

