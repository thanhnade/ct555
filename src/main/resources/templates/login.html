<!doctype html>
<html lang="vi">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ÄÄƒng nháº­p / ÄÄƒng kÃ½</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        crossorigin="anonymous">

    <script>
        async function login(event) {
            event.preventDefault();
            const username = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-password').value;

            try {
                const res = await fetch('/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                if (!res.ok) {
                    const msg = await res.json().catch(() => ({ message: 'ÄÄƒng nháº­p tháº¥t báº¡i' }));
                    setMessage('login-msg', msg.message || 'ÄÄƒng nháº­p tháº¥t báº¡i', true);
                    return;
                }

                const out = await res.json().catch(() => ({ redirect: '/home-user' }));
                setMessage('login-msg', 'ÄÄƒng nháº­p thÃ nh cÃ´ng, Ä‘ang chuyá»ƒn hÆ°á»›ng...', false);
                setTimeout(() => window.location.href = out.redirect || '/home-user', 1000);
            } catch (err) {
                setMessage('login-msg', 'âŒ Lá»—i há»‡ thá»‘ng: ' + err.message, true);
            }
        }

        async function registerUser(event) {
            event.preventDefault();
            const username = document.getElementById('reg-username').value.trim();
            const password = document.getElementById('reg-password').value;

            const res = await fetch('/auth/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            });

            if (res.ok) {
                setMessage('reg-msg', 'ğŸ‰ ÄÄƒng kÃ½ thÃ nh cÃ´ng! Vui lÃ²ng Ä‘Äƒng nháº­p.', false);
            } else {
                const msg = await res.text();
                setMessage('reg-msg', msg || 'ÄÄƒng kÃ½ tháº¥t báº¡i', true);
            }
        }

        function setMessage(id, text, isError) {
            const el = document.getElementById(id);
            el.innerHTML = `
                <div class="alert ${isError ? 'alert-danger' : 'alert-success'} alert-dismissible fade show p-2 mt-2" role="alert">
                  ${text}
                  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="ÄÃ³ng"></button>
                </div>`;
        }

        // Loading UI helpers
        function showLoading(msg) {
            let div = document.createElement('div');
            div.id = 'loading-indicator';
            div.style = `
                position:fixed;top:0;left:0;width:100vw;height:100vh;
                display:flex;align-items:center;justify-content:center;
                background:rgba(255,255,255,0.75);z-index:9999;`;
            div.innerHTML = `
                <div style='text-align:center'>
                  <div class="spinner-border text-primary mb-3" role="status"></div>
                  <br><span>${msg}</span>
                </div>`;
            document.body.appendChild(div);
        }
        function hideLoading() {
            const d = document.getElementById('loading-indicator');
            if (d) d.remove();
        }
    </script>
</head>

<body class="bg-light">
    <div class="container py-5">
        <div class="row g-4">

            <!-- ÄÄƒng nháº­p -->
            <div class="col-12 col-lg-6">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h2 class="h5 mb-1">ÄÄƒng nháº­p</h2>
                        <p class="text-muted mb-3">Nháº­p tÃªn Ä‘Äƒng nháº­p vÃ  máº­t kháº©u Ä‘á»ƒ tiáº¿p tá»¥c</p>
                        <form onsubmit="login(event)">
                            <div class="mb-3">
                                <label for="login-username" class="form-label">TÃªn Ä‘Äƒng nháº­p</label>
                                <input id="login-username" class="form-control" autocomplete="username" required>
                            </div>
                            <div class="mb-3">
                                <label for="login-password" class="form-label">Máº­t kháº©u</label>
                                <input id="login-password" type="password" class="form-control"
                                    autocomplete="current-password" required>
                            </div>
                            <button type="submit" class="btn btn-primary w-100">ÄÄƒng nháº­p</button>
                        </form>
                        <div id="login-msg"></div>
                    </div>
                </div>
            </div>

            <!-- ÄÄƒng kÃ½ -->
            <div class="col-12 col-lg-6">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h2 class="h5 mb-1">ÄÄƒng kÃ½</h2>
                        <p class="text-muted mb-3">Táº¡o tÃ i khoáº£n má»›i</p>
                        <form onsubmit="registerUser(event)">
                            <div class="mb-3">
                                <label for="reg-username" class="form-label">TÃªn Ä‘Äƒng nháº­p</label>
                                <input id="reg-username" class="form-control" required>
                            </div>
                            <div class="mb-3">
                                <label for="reg-password" class="form-label">Máº­t kháº©u</label>
                                <input id="reg-password" type="password" class="form-control" required>
                            </div>
                            <button type="submit" class="btn btn-success w-100">ÄÄƒng kÃ½</button>
                        </form>
                        <div id="reg-msg"></div>
                    </div>
                </div>
            </div>

        </div>

    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        crossorigin="anonymous"></script>
</body>

</html>